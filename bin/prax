#! /usr/bin/env bash
#
# Usage: prax [subcommand]
#
# This file is a wrapper script intended for GNU/Linux systems. It loads the
# proper environment for Prax to run in, kills any instances running, and
# invokes Prax's CLI.


# Locate the real root:
cd `dirname $(readlink -f $0)`
PRAX_ROOT=`dirname $(pwd -P)`
cd $PRAX_ROOT

# Load either rbenv or RVM (if present):
if [ -x $HOME/.rbenv/bin/rbenv ] ; then
  export PATH="$HOME/.rbenv/bin:$PATH"
  eval "$(rbenv init -)"
elif [ -x $HOME/.rvm/scripts/rvm ] ; then
  . $HOME/.rvm/scripts/rvm
fi

# Load user config (if present):
if [ -f $HOME/.praxconfig ] ; then
  . $HOME/.praxconfig
fi

# Kill any existing copies:
old_pid=`ps x|grep praxd|grep -v grep|awk "{print \\$1}"`
[[ $old_pid != "" ]] && kill $old_pid


# Run our Ruby:
/usr/bin/env ruby <<-RUBY
args = "$*".split

require '$PRAX_ROOT/lib/prax'

Prax::CLI.new(args).run
RUBY

